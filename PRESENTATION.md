# FaceWatch 프로젝트 발표자료

---

## 슬라이드 1: 제목

# 🎯 FaceWatch
## 실시간 얼굴 식별·추적 시스템

**InsightFace 기반 고성능 얼굴 인식 AI 서비스**

---

## 슬라이드 2: 일상에서의 문제 발견

### 🔍 문제 상황

**편의점 CCTV 영상에서 용의자를 찾아야 하는데...**

- ❌ 수백 시간의 영상을 사람이 직접 확인해야 함
- ❌ 실시간 감지가 불가능하여 사후 대응만 가능
- ❌ 여러 각도, 마스크 착용 등 다양한 조건에서 인식 어려움
- ❌ 오탐으로 인한 시간 낭비

**"AI가 자동으로 용의자를 찾아주면 좋을 텐데..."**

---

## 슬라이드 3: 아이디어 선정

### 💡 해결 아이디어

**실시간 얼굴 인식 기반 용의자 추적 시스템**

#### 핵심 기능
- ✅ CCTV 영상에서 실시간 얼굴 감지 및 인식
- ✅ 등록된 용의자 자동 식별
- ✅ 다양한 각도 및 조건에서 인식 가능
- ✅ 웹 기반 사용자 친화적 인터페이스

#### 차별화 포인트
- 🎯 **실시간 처리**: WebSocket 기반 즉시 감지
- 🎯 **자동 학습**: 감지된 얼굴 임베딩 자동 수집
- 🎯 **다양한 각도 지원**: 정면부터 프로필까지
- 🎯 **오탐 최소화**: 고급 필터링 알고리즘

---

## 슬라이드 4: 서비스 플로우

### 📋 사용자 시나리오

```
1. 영상 업로드
   └─ CCTV 영상 파일 선택 (MP4, AVI, MOV)

2. 용의자 선택
   └─ 데이터베이스에서 감지할 대상 선택 (다중 선택 가능)

3. 실시간 모니터링
   └─ AI 감지 활성화 토글 ON
   └─ 실시간으로 얼굴 감지 및 인식

4. 결과 확인
   └─ 감지된 얼굴에 박스 표시
   └─ 범죄자 감지 시 빨간색 경고
   └─ 감지 로그 자동 저장
```

### 🎬 서비스 흐름도

```
[사용자] → [웹 UI] → [FastAPI 서버] → [InsightFace 모델]
                                    ↓
                            [PostgreSQL DB]
                                    ↓
                            [Bank 임베딩 매칭]
                                    ↓
                            [실시간 결과 반환]
```

---

## 슬라이드 5: 기술 기획 - 아키텍처

### 🏗️ 시스템 아키텍처

```
┌─────────────────────────────────────────┐
│         클라이언트 (웹 브라우저)          │
│  • HTML5 Video (영상 재생)              │
│  • Canvas API (박스 렌더링)            │
│  • WebSocket (실시간 통신)              │
└─────────────────┬───────────────────────┘
                  │ WebSocket / HTTP
                  │ (Base64 이미지)
                  ▼
┌─────────────────────────────────────────┐
│         FastAPI 백엔드 서버              │
│  • WebSocket 엔드포인트                 │
│  • HTTP API 엔드포인트                  │
│  • InsightFace 모델 (buffalo_l)        │
│  • 매칭 엔진 (Bank 임베딩)              │
└─────────────────┬───────────────────────┘
                  │
    ┌─────────────┼─────────────┐
    ▼             ▼             ▼
┌─────────┐ ┌─────────┐ ┌─────────┐
│PostgreSQL│ │Bank 임베딩│ │JSON 레거시│
└─────────┘ └─────────┘ └─────────┘
```

---

## 슬라이드 6: 기술 스택

### 🛠️ 기술 선택 이유

#### Backend
- **FastAPI**: 비동기 처리, 자동 API 문서 생성
- **InsightFace (buffalo_l)**: 높은 정확도, 다양한 각도 지원
- **PostgreSQL**: 영구 데이터 저장, 감지 로그 관리
- **WebSocket**: 실시간 양방향 통신

#### Frontend
- **HTML5 + JavaScript**: 범용성, 빠른 개발
- **Canvas API**: 고성능 박스 렌더링
- **Tailwind CSS**: 빠른 UI 개발

#### AI/ML
- **InsightFace**: 얼굴 감지 및 임베딩 추출
- **NumPy**: 벡터 연산 최적화
- **Cosine Similarity**: 임베딩 유사도 계산

---

## 슬라이드 7: AI 모델 선정

### 🤖 InsightFace 선택 이유

#### 비교 분석

| 모델 | 정확도 | 속도 | 각도 지원 | 마스크 대응 |
|------|--------|------|----------|------------|
| **InsightFace** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| FaceNet | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ |
| ArcFace | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |

#### 선택 이유
1. **높은 정확도**: buffalo_l 모델의 우수한 성능
2. **다양한 각도 지원**: 랜드마크 기반 각도 추정
3. **빠른 처리 속도**: ONNX Runtime 최적화
4. **활발한 커뮤니티**: 지속적인 업데이트 및 지원

#### 모델 사양
- **입력**: RGB 이미지 (임의 크기)
- **출력**: 512차원 임베딩 벡터
- **감지**: RetinaFace 기반 얼굴 검출
- **인식**: L2 정규화 후 Cosine 유사도 비교

---

## 슬라이드 8: 트러블 슈팅 1 - 프레임 끊김

### 🐛 문제: 서버사이드 렌더링

#### 초기 구현 방식
```
클라이언트 → 프레임 캡처 → Base64 인코딩
    ↓
HTTP POST 요청
    ↓
서버 → 얼굴 감지 → 이미지 렌더링 → Base64 반환
    ↓
클라이언트 → 이미지 표시
```

#### 문제점
- ❌ **프레임 끊김**: 매 프레임마다 이미지 인코딩/디코딩
- ❌ **높은 네트워크 사용량**: ~500KB/프레임
- ❌ **지연 시간**: 200-500ms
- ❌ **서버 부하**: 렌더링 작업이 서버에서 수행

#### 해결: 클라이언트사이드 렌더링
- ✅ 서버는 좌표만 전송 (~2KB/프레임)
- ✅ 클라이언트에서 Canvas API로 렌더링
- ✅ 네트워크 사용량 99% 감소

---

## 슬라이드 9: 트러블 슈팅 2 - 박스 튀는 현상

### 🐛 문제: HTTP 요청-응답 지연

#### 문제점
- ❌ **박스 튀는 현상**: 비동기 요청으로 인한 프레임 순서 불일치
- ❌ **네트워크 지연**: HTTP 요청-응답 사이클 지연
- ❌ **동기화 문제**: 비디오 재생 속도와 감지 결과 불일치

#### 해결: WebSocket 도입

**Before (HTTP)**
```
프레임 1 → 요청 → [지연] → 응답 → 렌더링
프레임 2 → 요청 → [지연] → 응답 → 렌더링
프레임 3 → 요청 → [지연] → 응답 → 렌더링
```

**After (WebSocket)**
```
연결 설정 (1회)
    ↓
프레임 1 → 전송 → 즉시 응답 → 렌더링
프레임 2 → 전송 → 즉시 응답 → 렌더링
프레임 3 → 전송 → 즉시 응답 → 렌더링
```

#### 성과
- ✅ 지연 시간: 100-300ms → **50-150ms**
- ✅ 프레임 끊김 완전 해결
- ✅ 박스 안정성 향상

---

## 슬라이드 10: 트러블 슈팅 3 - 오탐 문제

### 🐛 문제: 잘못된 인식

#### 문제 상황
- ❌ 같은 얼굴이 여러 인물로 매칭됨
- ❌ 일시적으로 잘못된 인물로 인식
- ❌ 마스크 착용 시 인식률 저하
- ❌ 저화질 영상에서 오탐 증가

#### 해결: 고급 오탐 방지 시스템

**1. bbox 기반 다중 매칭 필터링**
- IoU 및 중심점 거리로 같은 얼굴 영역 판단
- sim_gap이 충분히 크면 가장 높은 유사도만 인정

**2. 프레임 간 연속성 체크**
- 최근 5프레임 내 같은 인물 매칭 여부 확인
- 연속성이 없고 유사도가 낮으면 검토 대상으로 분리

**3. 마스크 감지 및 적응형 임계값**
- 유사도 기반 마스크 착용 가능성 추정
- 마스크 착용 시 임계값 자동 조정 (0.30 → 0.22~0.28)

**4. 화질 기반 적응형 임계값**
- 얼굴 크기 기반 화질 추정
- 고화질: 높은 임계값 (오탐 방지)
- 저화질: 낮은 임계값 (인식률 유지)

---

## 슬라이드 11: 최적화 1 - Bank 임베딩 시스템

### ⚡ 성능 향상 전략

#### 문제: 단일 임베딩의 한계
- ❌ 정면 사진만으로는 다양한 각도 인식 어려움
- ❌ 조명, 표정 변화에 취약
- ❌ 시간이 지나도 성능 향상 없음

#### 해결: Bank 임베딩 시스템

**구조**
```
outputs/embeddings/<person>/
├── bank.npy          # N×512 차원 (다중 각도 임베딩)
├── centroid.npy      # 512 차원 (평균 임베딩)
└── angles.json       # 각도 메타데이터
```

**동작 방식**
1. 매칭 시 Bank의 모든 임베딩과 비교
2. 최고 유사도 선택
3. 매칭 성공 시 해당 얼굴 임베딩 자동 추가
4. 중복 체크 (유사도 0.95 이상 스킵)

**성과**
- ✅ 다양한 각도 인식 가능
- ✅ 시간이 지날수록 정확도 향상
- ✅ 자동 학습으로 유지보수 최소화

---

## 슬라이드 12: 최적화 2 - 옆모습 감지

### 📐 얼굴 각도 감지 기능

#### 구현 방식
- **Yaw 각도 계산**: InsightFace 랜드마크 기반
- **5가지 각도 분류**:
  - `front`: 정면 (-15° ~ 15°)
  - `left`: 왼쪽 (-45° ~ -15°)
  - `right`: 오른쪽 (15° ~ 45°)
  - `left_profile`: 왼쪽 프로필 (-90° ~ -45°)
  - `right_profile`: 오른쪽 프로필 (45° ~ 90°)

#### 활용
- 각도별 임베딩 저장으로 인식 범위 확대
- UI에 각도 정보 표시로 사용자 피드백 제공
- 각도별 인식 성공률 통계 제공

#### 성과
- ✅ 정면뿐만 아니라 옆모습, 프로필까지 인식 가능
- ✅ 다양한 CCTV 각도에서 활용 가능

---

## 슬라이드 13: 최적화 3 - 박스 렌더링 개선

### 🎨 시각적 품질 향상

#### 개선 사항

**1. 박스 스타일**
- 선 두께 증가 (3px → 4px)
- 네 모서리 강조선 추가
- 색상 구분: 범죄자(빨강), 일반인(초록), 미확인(노랑)

**2. 텍스트 레이아웃**
- 중복 제거: 각도 정보 중복 표시 해결
- 계층적 표시: 경고 → 이름/신뢰도 → 각도 정보
- 반투명 배경 (80% 투명도)으로 가독성 향상

**3. 동적 위치 조정**
- 화면 경계 체크로 텍스트가 밖으로 나가지 않도록 조정
- 박스 위쪽 공간 없으면 아래쪽에 표시
- 좌우 경계를 넘지 않도록 자동 조정

**4. 좌표 변환 정확도**
- `object-contain` CSS 스타일 정확히 반영
- 비디오 표시 영역 정확히 계산
- 다양한 화면 크기에서 안정적 동작

---

## 슬라이드 14: 성능 개선 결과

### 📊 Before & After 비교

| 항목 | 초기 (서버사이드) | 개선 (WebSocket) | 개선율 |
|------|------------------|-----------------|--------|
| **네트워크 사용량** | ~500KB/프레임 | ~2KB/프레임 | **99% 감소** |
| **지연 시간** | 200-500ms | 50-150ms | **70% 감소** |
| **프레임 끊김** | 심함 | 없음 | **100% 해결** |
| **박스 안정성** | 불안정 | 안정적 | **대폭 향상** |

### 🎯 주요 성과

- ✅ **실시간 처리**: WebSocket 기반 즉시 감지
- ✅ **정확도 향상**: Bank 시스템으로 다양한 각도 인식
- ✅ **오탐 감소**: 고급 필터링 알고리즘으로 오탐 최소화
- ✅ **자동 학습**: 감지된 얼굴 임베딩 자동 수집
- ✅ **사용자 경험**: 부드러운 실시간 감지 및 시각적 피드백

---

## 슬라이드 15: 핵심 기술 - 적응형 임계값

### 🧠 지능형 임계값 조정

#### 3단계 적응형 시스템

**1단계: 화질 기반 조정**
```
고화질 (≥150px, ≥5%)  → 기본값 +0.04 (오탐 방지)
중화질 (≥100px, ≥2%)  → 기본값 유지
저화질 (그 외)        → 기본값 -0.03 (인식률 유지)
```

**2단계: 마스크 감지**
```
유사도 < 0.25  → 마스크 가능성 90% → 임계값 -0.05
유사도 0.25-0.28 → 마스크 가능성 70% → 임계값 -0.04
유사도 0.28-0.32 → 마스크 가능성 50% → 임계값 -0.02
유사도 ≥ 0.35  → 마스크 없음 → 임계값 유지
```

**3단계: 최종 임계값**
```
최종 임계값 = 기본값 + 화질 조정 + 마스크 조정
최소 임계값 보장 (0.28 ~ 0.30)
```

#### 효과
- ✅ 다양한 조건에서 최적의 인식률 유지
- ✅ 오탐 최소화
- ✅ 마스크 착용 시에도 인식 가능

---

## 슬라이드 16: 프로젝트 구조

### 📁 코드베이스 구조

```
FaceWatch/
├── backend/              # FastAPI 백엔드
│   ├── main.py          # WebSocket + HTTP API
│   ├── database.py      # PostgreSQL ORM
│   └── init_db.py       # DB 초기화
│
├── web/                 # 프론트엔드
│   ├── index.html       # 메인 페이지
│   ├── script.js        # 클라이언트 로직
│   └── style.css        # 스타일
│
├── src/                 # 코어 로직
│   ├── face_enroll.py   # 인물 등록
│   ├── face_match_cctv.py  # 통합 인식
│   └── utils/           # 유틸리티
│       ├── gallery_loader.py      # Bank 로더
│       ├── face_angle_detector.py # 각도 감지
│       └── mask_detector.py      # 마스크 감지
│
└── outputs/            # 출력
    ├── embeddings/      # Bank 임베딩
    └── results/        # 분석 결과
```

---

## 슬라이드 17: 주요 기능 데모

### 🎬 기능 시연

#### 1. 실시간 감지
- 비디오 업로드 → 용의자 선택 → 실시간 감지
- 박스가 부드럽게 따라다니며 인식 결과 표시

#### 2. 다중 용의자 추적
- 여러 명의 용의자 동시 선택
- 각각 다른 색상으로 구분 표시

#### 3. 범죄자 경고
- 범죄자 감지 시 빨간색 박스 및 경고 표시
- 화면 테두리 빨간색 애니메이션

#### 4. 각도 정보 표시
- 감지된 얼굴의 각도 정보 실시간 표시
- "왼쪽 프로필", "오른쪽" 등 텍스트 표시

---

## 슬라이드 18: 향후 계획

### 🗺️ 로드맵

#### 완료된 기능 ✅
- [x] WebSocket 기반 실시간 통신
- [x] Bank 임베딩 시스템
- [x] 옆모습 감지
- [x] 마스크 감지 및 적응형 임계값
- [x] 고급 오탐 방지
- [x] PostgreSQL 통합

#### 개발 중 🚧
- [ ] 얼굴 ID 추적 (동일 인물 연속 감지)
- [ ] 박스 위치 보간 (더 부드러운 이동)
- [ ] 실시간 성능 모니터링

#### 계획 중 📋
- [ ] Face anti-spoofing (딥페이크 방지)
- [ ] 감지 히스토리 타임라인
- [ ] 알림 설정 및 필터링
- [ ] 모바일 앱 지원
- [ ] **실종자 찾기 시스템**: 재난문자 연계
- [ ] **유기견 찾기**: 반려동물 인식 확장
- [ ] 전국 CCTV 네트워크 통합

---

## 슬라이드 19: 프로젝트 성과

### 🏆 주요 성과

#### 기술적 성과
- ✅ **실시간 처리**: 50-150ms 지연 시간 달성
- ✅ **정확도 향상**: Bank 시스템으로 다양한 각도 인식
- ✅ **오탐 최소화**: 고급 필터링으로 오탐 대폭 감소
- ✅ **자동 학습**: 시간이 지날수록 성능 향상

#### 사용자 경험
- ✅ **직관적인 UI**: 웹 기반 사용자 친화적 인터페이스
- ✅ **부드러운 감지**: 프레임 끊김 없는 실시간 감지
- ✅ **시각적 피드백**: 명확한 색상 구분 및 경고 시스템

#### 확장성
- ✅ **엔터프라이즈급**: PostgreSQL 기반 데이터 영구 저장
- ✅ **다중 데이터 소스**: PostgreSQL → Bank → JSON 자동 fallback
- ✅ **모듈화된 구조**: 유지보수 및 확장 용이

### 🌟 실용적 활용 사례

#### 재난문자 활용
**"000씨를 찾습니다"** - 실종자 찾기
- 실종자 사진을 등록하고 CCTV 영상에서 자동 검색
- 실시간으로 감지되면 즉시 알림 발송
- 재난문자와 연계하여 빠른 대응 가능

**활용 시나리오**
```
1. 실종자 가족이 사진 제공
2. 시스템에 실종자 등록
3. 전국 CCTV 네트워크 자동 스캔
4. 감지 시 즉시 알림 및 위치 정보 전송
5. 재난문자 발송으로 전국적 대응
```

#### 유기견 찾기 확장 아이디어
**반려동물 인식 시스템**
- 유기견 사진을 등록하여 CCTV에서 자동 검색
- 반려동물도 얼굴(코, 눈, 귀) 패턴으로 인식 가능
- 실종 반려동물을 빠르게 찾을 수 있는 시스템

**기술적 확장성**
- 동물 얼굴 인식 모델로 확장 가능
- 반려동물 전용 임베딩 시스템 구축
- 실종 동물 찾기 전용 플랫폼으로 발전 가능

---

## 슬라이드 20: 마무리

### 💡 핵심 메시지

**"일상의 문제를 AI 기술로 해결하다"**

- 🔍 **문제 발견**: CCTV 영상에서 용의자 찾기의 어려움
- 💡 **아이디어**: 실시간 얼굴 인식 기반 자동 추적 시스템
- 🛠️ **기술 선택**: InsightFace + FastAPI + WebSocket
- 🐛 **트러블 슈팅**: 프레임 끊김, 박스 튀는 현상, 오탐 문제 해결
- ⚡ **최적화**: Bank 시스템, 적응형 임계값, 옆모습 감지

### 🎯 최종 결과

**실시간으로, 정확하게, 자동으로 용의자를 찾는 AI 시스템**

### 🌍 사회적 가치

#### 실용적 활용
- **실종자 찾기**: 재난문자 "000씨를 찾습니다"와 연계
- **범죄 예방**: 실시간 용의자 감지로 범죄 예방
- **안전 강화**: 공공장소 보안 시스템 강화

#### 확장 가능성
- **유기견 찾기**: 반려동물 인식으로 확장 가능
- **실종 아동 찾기**: 아동 보호 시스템으로 활용
- **공공 안전**: 전국 CCTV 네트워크 통합 가능

**"AI 기술이 사회 문제 해결에 기여하는 실용적인 시스템"**

---

## 슬라이드 21: Q&A

### 🙋 질문 받기

**감사합니다!**

---

## 부록: 발표 팁

### 발표 시 강조할 포인트

1. **일상 스토리 (슬라이드 2)**
   - 실제 문제 상황을 생생하게 설명
   - "수백 시간의 영상을 사람이 직접 확인해야 한다"는 점 강조

2. **트러블 슈팅 (슬라이드 8-10)**
   - 문제 → 해결 과정을 단계별로 설명
   - Before/After 비교로 개선 효과 명확히 제시

3. **최적화 (슬라이드 11-13)**
   - 기술적 깊이를 보여주는 부분
   - Bank 시스템, 적응형 임계값 등 고급 기능 강조

4. **성능 개선 결과 (슬라이드 14)**
   - 구체적인 수치로 성과 제시
   - 99% 네트워크 감소, 70% 지연 시간 감소 등

### 발표 시간 배분 (20분 기준)

- 일상 스토리 & 아이디어: 2분
- 서비스 플로우 & 기술 기획: 3분
- AI 모델 선정: 2분
- 트러블 슈팅: 5분 (핵심!)
- 최적화: 5분 (핵심!)
- 성과 & 마무리: 3분

