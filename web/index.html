<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCTV 인물 식별 서비스</title>
    <!-- Pretendard 폰트 -->
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Pretendard', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'Roboto', 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <link rel="stylesheet" href="style.css">
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>👤</text></svg>">
</head>

<body class="bg-slate-50 min-h-screen font-sans tracking-tight">

    <!-- 메인 대시보드 화면 (항상 표시) -->
    <div id="dashboardScreen" class="min-h-screen">
        <header class="dashboard-header text-white p-4 shadow-sm">
            <div class="container mx-auto px-4 flex justify-between items-center">
                <h1 class="text-2xl font-semibold tracking-tight">A 편의점 CCTV (정문입구)</h1>
                <div class="flex gap-3">
                    <button id="openUploadModalBtn"
                        class="bg-white/20 hover:bg-white/30 backdrop-blur-sm border border-white/30 text-white px-4 py-2 rounded-lg font-medium transition-all duration-200">
                        영상 업로드
                    </button>
                    <button id="openSuspectModalBtn"
                        class="bg-white/20 hover:bg-white/30 backdrop-blur-sm border border-white/30 text-white px-4 py-2 rounded-lg font-medium transition-all duration-200">
                        인물 선택
                    </button>
                </div>
            </div>
        </header>

        <!-- 메인 대시보드 콘텐츠 래퍼 (중앙 정렬) -->
        <div style="display: flex; justify-content: center; align-items: flex-start; width: 100%;">
            <div style="transform: scale(0.75); transform-origin: center top; width: 100%; max-width: 1280px;">
                <div class="container mx-auto px-4 py-4">
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                        <!-- 통합 플레이어 컨테이너 -->
                        <div class="lg:col-span-3 bg-white rounded-xl shadow-md overflow-hidden border border-gray-200">
                            <!-- 통합 헤더 -->
                            <div
                                class="flex justify-between items-center px-6 py-4 border-b border-gray-200 bg-gray-50">
                                <h2 class="text-xl font-semibold text-gray-800 tracking-tight">실시간 영상</h2>
                                <span
                                    class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-700 animate-pulse">●
                                    LIVE</span>
                            </div>

                            <!-- 비디오 섹션 (상단) -->
                            <div class="flex-1 bg-black overflow-hidden video-container relative h-[600px]">
                                <!-- 빈 상태 (영상 없을 때만 표시) -->
                                <div id="emptyStateCard"
                                    class="absolute inset-0 flex items-center justify-center bg-gray-900 z-20">
                                    <div class="text-center cursor-pointer hover:scale-105 transition-all duration-300">
                                        <svg class="w-32 h-32 mx-auto mb-6 text-indigo-400" fill="none"
                                            stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z">
                                            </path>
                                        </svg>
                                        <h2 class="text-3xl font-bold text-white mb-3">영상을 업로드하세요</h2>
                                        <p class="text-gray-400 mb-6">클릭하여 CCTV 영상 파일을 선택하거나<br>상단 "영상 업로드" 버튼을 이용하세요
                                        </p>
                                        <div class="text-sm text-gray-500">
                                            <p>지원 형식: MP4, AVI, MOV</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- 비디오 플레이어 -->
                                <video id="mainVideo" class="w-full h-full object-contain absolute inset-0" controls
                                    playsinline preload="metadata"></video>
                                <canvas id="detectionCanvas" class="w-full h-full object-contain absolute inset-0"
                                    style="z-index: 10; pointer-events: none;"></canvas>
                            </div>

                            <!-- 타임라인 섹션 (하단) -->
                            <div class="bg-gray-50 border-t border-gray-200 px-6 py-4">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-sm font-semibold text-gray-700 tracking-tight">인물 감지 타임라인</h3>
                                    <div class="flex gap-2">
                                        <button id="viewClipsBtn"
                                            class="text-xs bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1.5 rounded-lg font-medium transition-all duration-200 shadow-sm">
                                            클립 보기 (<span id="clipCount">0</span>)
                                        </button>
                                        <button id="viewSnapshotsBtn"
                                            class="text-xs bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1.5 rounded-lg font-medium transition-all duration-200 shadow-sm">
                                            스냅샷 보기 (<span id="snapshotCount">0</span>)
                                        </button>
                                        <button id="extractFramesBtn"
                                            class="text-xs bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1.5 rounded-lg font-medium transition-all duration-200 shadow-sm disabled:opacity-50 disabled:cursor-not-allowed"
                                            title="모든 프레임 추출 (라벨링용)">
                                            프레임 추출
                                        </button>
                                    </div>
                                </div>
                                <!-- 인물별 타임라인 트랙이 동적으로 생성됩니다 -->
                                <div id="timelinesContainer" class="space-y-1.5 overflow-visible">
                                    <!-- 타임라인 트랙들이 여기에 추가됩니다 -->
                                </div>
                            </div>
                        </div>

                        <div class="lg:col-span-1 space-y-4">
                            <!-- 긴급 상황 전파 시스템 -->
                            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-5 border-red-200">
                                <button id="dispatchReportBtn" disabled
                                    class="w-full bg-red-600 hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-bold py-3 px-4 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg flex items-center justify-center gap-2 tracking-tight relative overflow-hidden">
                                    <span
                                        class="absolute inset-0 bg-red-400 opacity-0 hover:opacity-20 transition-opacity duration-300"></span>
                                    <svg class="w-5 h-5 relative z-10 animate-pulse" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z">
                                        </path>
                                    </svg>
                                    <span class="relative z-10">발견 보고 전송</span>
                                </button>
                            </div>

                            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-5">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4 tracking-tight">제어판</h3>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700 tracking-tight">AI 감지 활성화</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="detectionFilter">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>

                            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-5">
                                <h3 class="text-lg font-semibold text-gray-800 mb-2 tracking-tight">시스템 상태</h3>
                                <div class="flex justify-between text-sm tracking-tight">
                                    <span class="text-gray-600">연결 상태</span>
                                    <span
                                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-700"
                                        id="connectionStatus">정상</span>
                                </div>
                            </div>

                            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 flex-1">
                                <div class="flex justify-between items-center mb-6">
                                    <h3 class="text-lg font-semibold text-gray-800 tracking-tight">감지 로그</h3>
                                    <button id="downloadLogBtn"
                                        class="text-xs bg-gray-100 hover:bg-gray-200 text-gray-600 px-2 py-1 rounded-lg font-medium transition-all duration-200 shadow-sm flex items-center gap-1">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4">
                                            </path>
                                        </svg>
                                        CSV 저장
                                    </button>
                                </div>
                                <div id="detectionInfo" class="h-[300px] overflow-y-auto pr-2">
                                    <ul id="detectionLogList" class="flex flex-col gap-3">
                                        <li class="text-gray-500 text-center py-4 tracking-tight">대기 중...</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 인물 수정 모달 -->
    <div id="editPersonModal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]">
        <div class="bg-white rounded-2xl shadow-lg max-w-md w-full mx-4">
            <div class="p-6 border-b">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-semibold text-gray-800 tracking-tight">인물 정보 수정</h2>
                    <button id="closeEditPersonModal"
                        class="text-gray-500 hover:text-gray-700 text-3xl transition-all">&times;</button>
                </div>
            </div>

            <form id="editPersonForm" class="p-6">
                <input type="hidden" id="editPersonId">

                <!-- 이름 -->
                <div class="mb-4">
                    <label for="editPersonName"
                        class="block text-sm font-medium text-gray-700 mb-2 tracking-tight">이름</label>
                    <input type="text" id="editPersonName" required
                        class="w-full border border-gray-300 rounded-lg px-4 py-2 tracking-tight focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>

                <!-- 카테고리 -->
                <div class="mb-6">
                    <label for="editPersonCategory"
                        class="block text-sm font-medium text-gray-700 mb-2 tracking-tight">카테고리</label>
                    <select id="editPersonCategory" required
                        class="w-full border border-gray-300 rounded-lg px-4 py-2 tracking-tight focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="criminal">범죄자</option>
                        <option value="missing">실종자</option>
                        <option value="dementia">치매환자</option>
                        <option value="child">미아</option>
                        <option value="wanted">수배자</option>
                        <option value="custom">기타 (직접입력)</option>
                    </select>
                </div>

                <!-- 직접 입력 필드 (기타 선택 시에만 표시) -->
                <div id="editCustomCategoryContainer" class="hidden mb-6">
                    <label for="editPersonCategoryCustom"
                        class="block text-sm font-medium text-gray-700 mb-2 tracking-tight">카테고리 직접 입력 <span
                            class="text-red-500">*</span></label>
                    <input type="text" id="editPersonCategoryCustom"
                        class="w-full border border-gray-300 rounded-lg px-4 py-2 tracking-tight focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="예: VIP, 블랙리스트 등">
                </div>

                <!-- 버튼 -->
                <div class="flex gap-3">
                    <button type="button" id="cancelEditPersonBtn"
                        class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-2.5 px-4 rounded-lg font-medium transition-all duration-200 tracking-tight">
                        취소
                    </button>
                    <button type="submit"
                        class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white py-2.5 px-4 rounded-lg font-medium transition-all duration-200 shadow-sm tracking-tight">
                        저장
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Hidden file input for direct file selection -->
    <input type="file" id="videoFile" accept="video/*" class="hidden">

    <!-- 인물 선택 모달 -->
    <div id="suspectSelectModal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto">
        <div class="bg-white rounded-2xl shadow-sm max-w-4xl w-full mx-4 my-8 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b sticky top-0 bg-white z-10">
                <div class="flex justify-between items-center mb-2">
                    <h1 class="text-3xl font-semibold text-gray-800 tracking-tight">인물 데이터베이스</h1>
                    <button id="closeSuspectModal"
                        class="text-gray-500 hover:text-gray-700 text-3xl transition-all">&times;</button>
                </div>
                <p class="text-gray-600 tracking-tight">찾을 대상을 선택해주세요</p>
            </div>

            <div class="p-6">
                <!-- 상단 버튼 그룹 -->
                <div class="flex justify-between items-center mb-6">
                    <div class="flex gap-2">
                        <button id="selectAllPersonsBtn"
                            class="bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg font-medium transition-all duration-200 shadow-sm tracking-tight text-sm">
                            ✓ 전체 선택
                        </button>
                        <button id="deselectAllPersonsBtn"
                            class="bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 px-4 rounded-lg font-medium transition-all duration-200 shadow-sm tracking-tight text-sm">
                            ✗ 전체 해제
                        </button>
                    </div>
                    <div class="flex gap-2">
                        <button id="deleteSelectedPersonsBtn"
                            class="bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg font-medium transition-all duration-200 shadow-sm tracking-tight text-sm disabled:opacity-50 disabled:cursor-not-allowed"
                            disabled>
                            선택 삭제 (<span id="selectedPersonCount">0</span>)
                        </button>
                        <button id="addSuspectBtn"
                            class="bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-6 rounded-lg font-medium transition-all duration-200 shadow-sm tracking-tight">
                            + 인물 추가
                        </button>
                    </div>
                </div>

                <div id="suspectCardsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- 인물 카드가 동적으로 생성됩니다 -->
                    <div class="col-span-full text-center py-8 text-gray-500">
                        <p>인물 목록을 불러오는 중...</p>
                    </div>
                </div>

                <div id="selectedSuspectInfo" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <h4 class="font-semibold text-slate-800 mb-2 tracking-tight">선택된 대상:</h4>
                    <div id="selectedSuspectName" class="text-gray-700"></div>
                    <p class="text-sm text-gray-500 mt-2 tracking-tight">여러 명을 선택하려면 카드를 클릭하세요</p>
                </div>

                <div class="text-center">
                    <button id="proceedToDashboard"
                        class="bg-indigo-600 hover:bg-indigo-700 text-white py-3 px-8 rounded-lg text-lg font-medium transition-all duration-200 shadow-sm disabled:opacity-50 tracking-tight"
                        disabled>
                        모니터링 시작
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 인물 추가 모달 -->
    <div id="addSuspectModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-sm max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800 tracking-tight">인물 등록</h2>
                    <button id="closeAddSuspectModal"
                        class="text-gray-500 hover:text-gray-700 text-2xl transition-all">&times;</button>
                </div>

                <form id="addSuspectForm" class="space-y-4">
                    <!-- 인물 ID는 자동 생성되므로 숨김 -->
                    <input type="hidden" id="enrollPersonId" required>

                    <div>
                        <label for="enrollName" class="block text-sm font-medium text-gray-700 mb-1">
                            이름 <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="enrollName" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent tracking-tight"
                            placeholder="예: 홍길동">
                    </div>

                    <div>
                        <label for="enrollImage" class="block text-sm font-medium text-gray-700 mb-1">
                            정면 사진 <span class="text-red-500">*</span>
                        </label>
                        <div
                            class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition-colors">
                            <input type="file" id="enrollImage" accept="image/*" required class="hidden">
                            <label for="enrollImage" class="cursor-pointer">
                                <div id="imagePreview" class="hidden mb-2">
                                    <img id="previewImg" src="" alt="미리보기"
                                        class="max-w-full max-h-48 mx-auto rounded-lg">
                                </div>
                                <div id="imagePlaceholder" class="text-gray-500">
                                    <svg class="w-12 h-12 mx-auto mb-2" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                                        </path>
                                    </svg>
                                    <p>클릭하여 사진 선택</p>
                                    <p class="text-xs mt-1">JPEG, PNG 등 지원</p>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div>
                        <label for="personCategory" class="block text-sm font-medium text-gray-700 mb-1">
                            카테고리 <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <select id="personCategory" required
                                class="w-full px-3 py-2 h-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent tracking-tight bg-white appearance-none cursor-pointer pr-10">
                                <option value="criminal">범죄자</option>
                                <option value="missing">실종자</option>
                                <option value="dementia">치매환자</option>
                                <option value="child">미아</option>
                                <option value="wanted">수배자</option>
                                <option value="custom">기타 (직접입력)</option>
                            </select>
                            <!-- 커스텀 드롭다운 화살표 -->
                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- 직접 입력 필드 (기타 선택 시에만 표시) -->
                    <div id="customCategoryContainer" class="hidden">
                        <label for="personCategoryCustom" class="block text-sm font-medium text-gray-700 mb-1">
                            카테고리 직접 입력 <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="personCategoryCustom"
                            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent tracking-tight"
                            placeholder="카테고리를 직접 입력하세요 (예: VIP, 스토커)">
                        <!-- Hidden input for form submission -->
                        <input type="hidden" id="personTypeInput" name="personType" value="criminal">
                    </div>

                    <div id="enrollError"
                        class="hidden bg-red-50 border border-red-200 rounded-lg p-3 text-red-700 text-sm"></div>
                    <div id="enrollSuccess"
                        class="hidden bg-green-50 border border-green-200 rounded-lg p-3 text-green-700 text-sm"></div>

                    <div class="flex gap-3 pt-4">
                        <button type="button" id="cancelEnrollBtn"
                            class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-2 px-4 rounded-lg font-medium transition-all duration-200 shadow-sm tracking-tight">
                            취소
                        </button>
                        <button type="submit" id="submitEnrollBtn"
                            class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-lg font-medium transition-all duration-200 shadow-sm disabled:opacity-50 disabled:cursor-not-allowed tracking-tight">
                            등록
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 클립 갤러리 모달 -->
    <div id="clipModal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-sm max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col">
            <div class="p-8 border-b flex justify-between items-center">
                <h2 class="text-2xl font-semibold text-gray-800 tracking-tight">인물 감지 클립</h2>
                <button id="closeClipModalBtn" class="text-gray-500 hover:text-gray-700 transition-all">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
            <!-- 인물별 필터 탭 -->
            <div id="clipTabs" class="px-8 pt-4 border-b bg-gray-50">
                <div class="flex flex-wrap gap-2 overflow-x-auto pb-2">
                    <!-- 탭이 동적으로 추가됩니다 -->
                </div>
            </div>
            <div class="p-8 overflow-y-auto flex-1">
                <div id="clipList" class="space-y-6">
                    <!-- 클립 카드가 동적으로 추가됩니다 -->
                </div>
            </div>
            <div class="p-8 border-t flex justify-between items-center">
                <div class="flex gap-2">
                    <button id="selectAllClipsBtn"
                        class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-medium transition-all duration-200 shadow-sm tracking-tight text-sm">
                        전체 선택
                    </button>
                    <button id="deselectAllClipsBtn"
                        class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-medium transition-all duration-200 shadow-sm tracking-tight text-sm">
                        전체 해제
                    </button>
                </div>
                <div class="flex gap-2">
                    <button id="downloadSelectedClipsBtn"
                        class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-all duration-200 shadow-sm tracking-tight disabled:opacity-50 disabled:cursor-not-allowed">
                        선택 다운로드 (<span id="selectedClipCount">0</span>)
                    </button>
                    <button id="closeClipModalBtn2"
                        class="bg-slate-600 hover:bg-slate-700 text-white px-4 py-2 rounded-lg font-medium transition-all duration-200 shadow-sm tracking-tight">
                        닫기
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 긴급 신고 모달 -->
    <div id="emergencyCallModal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-lg max-w-md w-full mx-4">
            <div class="p-6">
                <div class="flex items-center justify-center mb-4">
                    <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center">
                        <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z">
                            </path>
                        </svg>
                    </div>
                </div>
                <h2 class="text-2xl font-bold text-gray-800 text-center mb-2 tracking-tight">긴급 신고</h2>
                <p class="text-gray-600 text-center mb-6 tracking-tight">가까운 경찰서(A지구대)로 연결하시겠습니까?</p>
                <div class="bg-gray-50 rounded-lg p-4 mb-6 text-center">
                    <p class="text-sm text-gray-500 mb-1 tracking-tight">경찰서 전화번호</p>
                    <p class="text-2xl font-bold text-gray-800 tracking-tight">112</p>
                </div>
                <div class="flex gap-3">
                    <button id="cancelEmergencyCallBtn"
                        class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium transition-all duration-200 shadow-sm tracking-tight">
                        취소
                    </button>
                    <a id="confirmEmergencyCallBtn" href="tel:112"
                        class="flex-1 bg-red-600 hover:bg-red-700 text-white py-3 px-4 rounded-lg font-bold text-center transition-all duration-200 shadow-md hover:shadow-lg tracking-tight">
                        통화 연결
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- 긴급 전파 리포트 모달 -->
    <div id="dispatchReportModal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto p-4">
        <div class="bg-white rounded-2xl shadow-lg max-w-4xl w-full my-8">
            <!-- Section A: 헤더 -->
            <div class="p-6 border-b bg-red-50">
                <div class="flex justify-between items-start mb-2">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 tracking-tight flex items-center gap-2">
                            🚨 긴급 상황 전파 리포트
                            <span class="text-sm font-normal text-gray-600">(생성됨)</span>
                        </h2>
                        <p class="text-sm text-gray-600 mt-1 tracking-tight">수신: 마포경찰서 상황실 (자동 배정됨)</p>
                    </div>
                    <button id="closeDispatchModalBtn" class="text-gray-500 hover:text-gray-700 transition-all">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Section B: 동적 인물 리스트 컨테이너 -->
            <div id="dispatchReportList" class="p-6 space-y-8 divide-y divide-gray-200 max-h-[60vh] overflow-y-auto">
                <!-- 자바스크립트로 인물별 카드 생성됨 -->
            </div>

            <!-- Section D: 액션 버튼 (하단) -->
            <div class="p-6 border-t bg-gray-50 flex justify-end gap-3">
                <button id="cancelDispatchBtn"
                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 px-6 rounded-lg font-medium transition-all duration-200 shadow-sm tracking-tight">
                    취소
                </button>
                <button id="sendDispatchReportBtn"
                    class="bg-red-600 hover:bg-red-700 text-white py-3 px-6 rounded-lg font-bold transition-all duration-200 shadow-md hover:shadow-lg flex items-center gap-2 tracking-tight">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                    </svg>
                    경찰서로 즉시 전송
                </button>
            </div>
        </div>
    </div>

    <!-- 스냅샷 갤러리 모달 -->
    <div id="snapshotModal"
        class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-sm max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col">
            <div class="p-4 border-b flex justify-between items-center">
                <h2 class="text-2xl font-semibold text-gray-800 tracking-tight">인물 감지 스냅샷</h2>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700 transition-all">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
            <!-- 인물별 필터 탭 -->
            <div id="snapshotTabs" class="px-4 pt-4 border-b bg-gray-50">
                <div class="flex flex-wrap gap-2 overflow-x-auto">
                    <!-- 탭이 동적으로 추가됩니다 -->
                </div>
            </div>
            <div class="p-4 overflow-y-auto flex-1">
                <div id="snapshotGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- 스냅샷 카드가 동적으로 추가됩니다 -->
                </div>
            </div>
            <div class="p-4 border-t flex justify-between items-center">
                <div class="flex gap-2">
                    <button id="selectAllBtn"
                        class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-medium transition-all duration-200 shadow-sm tracking-tight text-sm">
                        전체 선택
                    </button>
                    <button id="deselectAllBtn"
                        class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-medium transition-all duration-200 shadow-sm tracking-tight text-sm">
                        전체 해제
                    </button>
                </div>
                <div class="flex gap-2">
                    <button id="downloadSelectedBtn"
                        class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-all duration-200 shadow-sm tracking-tight disabled:opacity-50 disabled:cursor-not-allowed">
                        선택 다운로드 (<span id="selectedCount">0</span>)
                    </button>
                    <button id="downloadAllBtn"
                        class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-all duration-200 shadow-sm tracking-tight">
                        전체 다운로드
                    </button>
                    <button id="closeModalBtn2"
                        class="bg-slate-600 hover:bg-slate-700 text-white px-4 py-2 rounded-lg font-medium transition-all duration-200 shadow-sm tracking-tight">
                        닫기
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ES Modules -->
    <script type="module" src="script.js"></script>
    <script defer src="snapshot_functions.js"></script>

</body>

</html>